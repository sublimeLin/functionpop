<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.20.2/dist/bootstrap-table.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <title>f.pop 後台管理</title>
    <title>f.pop 後台管理</title>
    <style>
        .fpopCard {
            width: 200px;
            height: 90px;
            text-align: center;
        }


        .chart-box {
            width: 500px;
            margin: 2% 1%;
            /* background-color: #fff; */
            /* box-shadow: 0 0 2rem 0 rgba(136, 152, 170, 0.2); */
            border: 1px solid rgb(227, 227, 227);
            border-radius: 5px;
            height: 350px;
        }

        .chart-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .chart-header span {
            display: block;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: #aa9988;
        }

        .fpop-card-text {
            font-size: 14px;
            font-weight: 500;
        }

        .modal-inp {
            height: 30px;
            width: 200px;
            border: 1px solid #acacac;
            border-radius: 6px;
            font-size: 10px;
            padding: 0 10px;
        }

        .card-text {
            margin-bottom: 0px !important;

        }

        .productName {
            text-align: left;
            padding-left: 30px;
        }
        /* *{
            color: rgba(252, 205, 34, 0.856);
        } */
    </style>

</head>

<body>
    <%- include("admin_navbar.ejs") %>


        <!-- Main Content -->
        <div class="fpop-main p-5" style="background-color: #FFF;">
          
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin/goods">首頁</a></li>
                    <li class="breadcrumb-item"><a href="/admin/goods/orderMgat_num">訂單管理</a></li>
                    <li class="breadcrumb-item active" aria-current="page">訂單編號</li>
                </ol>
            </nav>
            <!-- justify-content-center align-items-center -->
            <div class="row justify-content-center align-items-center text-center">
                <div class="card text-bg-info col-2 m-3">
                    <div class="card-body row">
                        <div class="col-3"><svg xmlns="http://www.w3.org/2000/svg" style="color:#9BD379;"
                                width="40" height="40" fill="currentColor" class="bi bi-clipboard-check"
                                viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z" />
                                <path
                                    d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z" />
                                <path
                                    d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z" />
                            </svg></div>
                        <div class="col-9">
                            <p class="card-text p-1" style="font-size: 16px;">今日訂單數量</p>
                            <p class="card-text">
                                <%= orderToday_count %>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="card text-bg-primary col-2 m-3">
                    <div class="card-body row">
                        <div class="col-3"> <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
                                fill="currentColor" style="color:#9BD379  ;" class="bi bi-clipboard-data"
                                viewBox="0 0 16 16">
                                <path
                                    d="M4 11a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0v-1zm6-4a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0V7zM7 9a1 1 0 0 1 2 0v3a1 1 0 1 1-2 0V9z" />
                                <path
                                    d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z" />
                                <path
                                    d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z" />
                            </svg></div>
                        <div class="col-9">
                            <p class="card-text p-1" style="font-size: 16px;">一週訂單數量</p>
                            <p class="card-text">
                                <%= orderWeek %>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card text-bg-info col-2 m-3">
                    <div class="card-body row">
                        <div class="col-3"><svg xmlns="http://www.w3.org/2000/svg" width="43" height="43"
                                style="color:#9BD379  ;" fill="currentColor" class="bi bi-currency-exchange"
                                viewBox="0 0 16 16">
                                <path
                                    d="M0 5a5.002 5.002 0 0 0 4.027 4.905 6.46 6.46 0 0 1 .544-2.073C3.695 7.536 3.132 6.864 3 5.91h-.5v-.426h.466V5.05c0-.046 0-.093.004-.135H2.5v-.427h.511C3.236 3.24 4.213 2.5 5.681 2.5c.316 0 .59.031.819.085v.733a3.46 3.46 0 0 0-.815-.082c-.919 0-1.538.466-1.734 1.252h1.917v.427h-1.98c-.003.046-.003.097-.003.147v.422h1.983v.427H3.93c.118.602.468 1.03 1.005 1.229a6.5 6.5 0 0 1 4.97-3.113A5.002 5.002 0 0 0 0 5zm16 5.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0zm-7.75 1.322c.069.835.746 1.485 1.964 1.562V14h.54v-.62c1.259-.086 1.996-.74 1.996-1.69 0-.865-.563-1.31-1.57-1.54l-.426-.1V8.374c.54.06.884.347.966.745h.948c-.07-.804-.779-1.433-1.914-1.502V7h-.54v.629c-1.076.103-1.808.732-1.808 1.622 0 .787.544 1.288 1.45 1.493l.358.085v1.78c-.554-.08-.92-.376-1.003-.787H8.25zm1.96-1.895c-.532-.12-.82-.364-.82-.732 0-.41.311-.719.824-.809v1.54h-.005zm.622 1.044c.645.145.943.38.943.796 0 .474-.37.8-1.02.86v-1.674l.077.018z" />
                            </svg></div>
                        <div class="col-9">
                            <p class="card-text p-1" style="font-size: 16px;">今日銷售總額</p>
                            <p class="card-text">$ <%= sale_today %>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card text-bg-info col-2 m-3">
                    <div class="card-body row">
                        <div class="col-4"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
                                style="color:#9BD379  ;" fill="currentColor" class="bi bi-graph-up-arrow"
                                viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M0 0h1v15h15v1H0V0Zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5Z" />
                            </svg></div>
                        <div class="col-8">
                            <p class="card-text p-1" style="font-size: 16px;">總銷售額</p>
                            <p class="card-text">$ <%= allSumcount %>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
            <div class="row justify-content-center align-items-center">

                <div class="chart-box">
                    <div class="chart-header">
                        <h4 class="title">今日訂單</h4>
                    </div>
                    <div class="chart-body m-4">
                        <table class="table">
                            <thead>
                                <th class="col-4">訂單編號</th>
                                <th class="col-3">名稱</th>
                                <th class="col-5">下單時間</th>
                            </thead>
                            <tbody>
                                <% orderToday.forEach((item ,index)=> { %>
                                    <tr>
                                        <td>
                                            <%= item.order_list %>
                                        </td>
                                        <td>
                                            <%= item.user_name %>
                                        </td>
                                        <td>
                                            <%= moment(item.order_update).format(shortDataFormat) %>
                                        </td>
                                    </tr>
                                    <% }) %>
                            </tbody>
                        </table>

                    </div>
                </div>
                <div class="chart-box">

                    <div class="chart-header">
                        <h4 class="title">每日訂單量</h4>
                    </div>

                    <div class="chart-body">
                        <canvas id="myChart-5"></canvas>
                        <script>
                            var ctx = document.getElementById('myChart-5');
                            var myChart = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: ['07/01', '07/02', '07/03', '07/04', '07/05', '07/06', '07/07'],
                                    datasets: [{
                                        backgroundColor: 'rgba(252, 205, 34, 0.2)',
                                        borderColor: '#FFCB2D',
                                        borderWidth: 3,
                                        label: '標籤名稱',
                                        data: [2, 10, 8, 15, 10, 25, 30],
                                        fill: true, // 是否填滿色彩
                                        pointStyle: 'rect', // 點點樣式
                                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                                    }]
                                },
                                options: {
                                    legend: {
                                        labels: {
                                            fontColor: '#333333' // 標籤顏色 
                                        }
                                    },
                                    scales: {
                                        xAxes: [{
                                            gridLines: {
                                                color: '#F2F2F2' // X軸 線條顏色
                                            },
                                            ticks: {
                                                fontColor: "#CCC" // X軸 文字顏色 
                                            },
                                        }],
                                        yAxes: [{
                                            gridLines: {
                                                color: '#F2F2F2' // Y軸 線條顏色 
                                            },
                                            ticks: {
                                                fontColor: "#CCC", // Y軸 文字顏色 
                                                beginAtZero: true // Y軸 從0開始
                                            },
                                        }]
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>
                <!-- end chart-body -->

            </div>
            <div class="col-lg mt-5">
                <div class="card h-100">

                    <div class="card-body d-flex align-items-center">
                        <table class="table table-striped m-3 p-3">
                            <thead>
                                <th class="col-1">訂單編號</th>
                                <th class="col-1">姓名</th>
                                <th class="col-1">信箱</th>
                                <th class="col-1">電話</th>
                                <th class="col-3">地址</th>
                                <th class="col-2">下單日期</th>
                                <th class="col-1"></th>
                            </thead>
                            <tbody>
                                <% data.forEach((item ,index)=> { %>
                                    <tr>
                                        <td>
                                            <%= item.order_list %>
                                        </td>
                                        <td>
                                            <%= item.user_name %>
                                        </td>
                                        <td>
                                            <%= item.user_email %>
                                        </td>
                                        <td>
                                            <%= item.user_phone %>
                                        </td>
                                        <td>
                                            <%= item.user_address %>
                                        </td>
                                        <td>
                                            <%= moment(item.order_update).format(shortDataFormat) %>
                                        </td>
                                        <td>
                                            <button class="btn btn-outline-info btn-sm "
                                                onclick="Edit( <%= item.order_list %> )" class="btn btn-primary"
                                                data-toggle="modal" data-target="#myModal">訂單資訊</button>
                                        </td>

                                    </tr>
                                    <% }) %>
                            </tbody>
                        </table>
                    </div>

                    <div class="modal" id="myModal">
                        <form id="form" class="modal-content" style="width: 400px;">
                            <div id="mgatMod" class=" p-4">
                                <div class="row content">
                                    <div class="col-4 text-right">
                                        <h6>訂單編號: </h6>
                                    </div>
                                    <div class="col-8">
                                        <p name="modalInp1" type="text"></p>
                                    </div>
                                </div>
                                <div class="row content">
                                    <div class="col-4 text-right">
                                        <h6>姓　　名: </h6>
                                    </div>
                                    <div class="col-8">
                                        <p name="modalInp2" type="text"></p>
                                    </div>
                                </div>
                                <div class="row content">
                                    <div class="col-4 text-right">
                                        <h6>信　　箱: </h6>
                                    </div>
                                    <div class="col-8">
                                        <p name="modalInp3" type="text"></p>
                                    </div>
                                </div>
                                <div class="row content">
                                    <div class="col-4 text-right">
                                        <h6>電　　話: </h6>
                                    </div>
                                    <div class="col-8">
                                        <p name="modalInp4" type="text"></p>
                                    </div>
                                </div>
                                <div class="row content">
                                    <div class="col-4 text-right">
                                        <h6>地　　址: </h6>
                                    </div>
                                    <div class="col-8">
                                        <p name="modalInp5" type="text"></p>
                                    </div>
                                </div>
                                <div class="row content">
                                    <div class="col-4 text-right">
                                        <h6>總　　額: </h6>
                                    </div>
                                    <div class="col-8">
                                        <p name="modalInp6" type="text"></p>
                                    </div>
                                </div>
                                <hr>

                            </div>
                        </form>
                    </div>
                    <div class="text-center mb-4">

                        <a href="/admin/goods/orderMgat_num/<%= i %>"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                height="16" fill="currentColor" class="bi bi-arrow-left-short" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z" />
                            </svg></a>
                        <a href="/admin/goods/orderMgat_num/<%= i %>"></a>
                        <% for(var i=1; i <=last_page; i++) { %>
                            <a href="/admin/goods/orderMgat_num/<%= i %>">
                                <%= i%>
                            </a>
                            <% } %>
                                <a href="/admin/goods/orderMgat_num/<%= i+1 %>"><svg xmlns="http://www.w3.org/2000/svg"
                                        width="16" height="16" fill="currentColor" class="bi bi-arrow-right-short"
                                        viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z" />
                                    </svg></a>
                    </div>
                </div>
            </div>
            <p class="text-center mt-4">共 <%= total_nums %> 筆，共 <%= curr_page%>/<%= last_page%> 頁</p>

        </div>
        <script>
            function Edit(id) {

                $.ajax({
                    url: "http://localhost:3000/admin/goods/orderMgat_num/detail/" + id,
                    type: "GET",
                    success: function (res) {
                        var ress = JSON.parse(res)

                        $(".productName").remove();
                        ress.data.forEach(function (item) {
                            console.log(item);
                            var a = document.createElement("p");
                            $(a).prop("class", 'productName');
                            a.innerHTML =
                                 " 衣服編號: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + item.product_code + "<br>"
                                + " 商品名稱: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + item.product_name + "<br>"
                                + " 類　　別: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + item.product_category + "<br>"
                                + " 尺　　寸: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + item.size_name + "<br>"
                                + " 價　　格: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ " + item.UnitPrice + "<br>";
                            document.getElementById("mgatMod").appendChild(a);
                            console.log(a);
                            $("p[name='modalInp1']").text(item.order_list)
                            $("p[name='modalInp2']").text(item.user_name)
                            $("p[name='modalInp3']").text(item.user_email)
                            $("p[name='modalInp4']").text(item.user_phone)
                            $("p[name='modalInp5']").text(item.user_address)
                            $("p[name='modalInp6']").text("$ " + ress.message[0].COUNT)
                        });
                      
                    },
                    error: function () {
                        console.log("err")
                        console.log(id)
                        console.log(res)
                        alert("系統錯誤!")
                    },
                })

            }

            function serializeToJSON(data) {
                var values = {};
                for (index in data) {
                    values[data[index].name] = data[index].value;
                }
                return JSON.stringify(values)
            }
        </script> -->
        <!-- Main Content end-->


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>